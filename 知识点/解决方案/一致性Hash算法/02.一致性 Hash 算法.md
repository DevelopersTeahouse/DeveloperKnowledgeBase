# 一致性 Hash 算法

- 首先，我们将所有的地址置于一个环上，形成闭环，我们称之为 hash 环。我们将服务器的 ip 或者主机名求 hash 值然后对应到 hash 环上。针对客户端，我们也根据他的 ip 进行 hash 求值，对应到环上的某个位置，然后，按照顺时针方向找最近的服务器节点。

## 一致性 Hash 算法扩容分析

- 如果新增了一个服务器，那么原来可能靠近新增服务器下一个服务器的路由会重新路由到新增服务器上，对于其他客户端是没有影响的，只是这一小部分受影响
- 一致性 hash 算法使请求的迁移达到了最小，这样的算法对分布式集群来说比较合适，避免了大量的请求迁移

## 一致性 Hash 算法缩容分析

- 如果某个服务器下线了，那么路由到这个下线服务器的客户端就会路由到顺时针方向最近的一个未下线服务器，对于其他客户端没有影响，影响到的只是路由到下线服务器的客户端
- 一致性 hash 算法使请求的迁移达到最小，这样的算法对分布式集群来说比较合适，避免了大量的请求迁移
