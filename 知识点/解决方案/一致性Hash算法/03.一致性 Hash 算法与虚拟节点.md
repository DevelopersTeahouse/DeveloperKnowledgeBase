# 一致性 hash 算法与虚拟节点

- 一致性算法使每一台服务器负责一段，对于节点的增减都只需要重定位环空间的一小部分数据，具有较好的容错性和可拓展性
- 但是，一致性哈希算法在服务节点太少时，容易因为节点分部不均匀而造成数据倾斜问题，例如系统中只有两台服务器，但是其中一个节点只负责了很小的一段，而另一个节点负责了很大的一段，请求大量落在负责很大一段的节点上，这就是数据 (请求) 倾斜问题

## 数据倾斜问题解决方式

- 为了解决数据倾斜问题，一致性 hash 算法引入了虚拟节点机制，即对每一个服务器节点计算多个 hash，每个计算结果都放置一个此服务节点，称为虚拟节点
- 具体的做法可以在服务器 ip 或者主机名的后面增加编号来实现。
  - 比如，可以为每台服务器计算三个虚拟节点，于是可以分别计算“节点 1 的#1”，“节点 1 的#2”，“节点 1 的#3”，“节点 2 的#1”，“节点 2 的#2”，“节点 2 的#3”的哈希值，于是形成六个虚拟节点，当客户端被路由到虚拟节点的时候其实是被路由到该虚拟节点所对应的真实节点
